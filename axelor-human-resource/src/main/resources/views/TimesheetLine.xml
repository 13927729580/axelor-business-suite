<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_3.0.xsd">

	<grid name="timesheet-line-grid" title="Log time" model="com.axelor.apps.human.resource.db.TimesheetLine">
		<field name="project"/>
		<field name="date" />
		<field name="activity"/>
		<field name="visibleDuration" />
		<field name="durationStored" />
		<field name="user" />
		<field name="comment" />
	</grid>

	<form name="timesheet-line-form" title="Log time" model="com.axelor.apps.human.resource.db.TimesheetLine"
	    onNew="action-timesheet-line-attrs-set-duration-label"
	    onLoad="action-timesheet-line-attrs-set-duration-label,action-timesheet-line-record-set-visible-duration">
		<panel>
			<field name="project"/>
			<field name="activity" canNew="true"/>
			<field name="date" />
			<field name="visibleDuration" colSpan="3" onChange="action-timesheet-line-record-set-stored-duration"/>
			<label name="durationLabel" title="Hours" colSpan="1"/>
			<field name="durationStored" hidden="true" />
			<field name="user" hidden="true" />
			<field name="comment" colSpan="12" />
		</panel>
	</form>
	
	<action-attrs name="action-timesheet-line-attrs-set-duration-label">
	    <attribute name="title" for="durationLabel" expr="eval:__user__.timeLoggingPreferenceSelect == 'days' ? com.axelor.i18n.I18n.get('Days') : __user__.timeLoggingPreferenceSelect == 'minutes' ? com.axelor.i18n.I18n.get('Minutes') : com.axelor.i18n.I18n.get('Hours')"/>
	</action-attrs>
	
	<action-record name="action-timesheet-line-record-set-visible-duration" model="com.axelor.apps.human.resource.db.TimesheetLine">
	    <field name="visibleDuration" expr="call:com.axelor.apps.human.resource.service.employee.EmployeeService:getUserDuration(durationStored)"/>
	</action-record>
	
	<action-record name="action-timesheet-line-record-set-stored-duration" model="com.axelor.apps.human.resource.db.TimesheetLine">
	    <field name="durationStored" expr="call:com.axelor.apps.human.resource.service.employee.EmployeeService:getDurationHours(visibleDuration)"/>
	</action-record>
	
	<action-method name="action-timesheet-line-method-record-set-stored-duration">
	    <call class="com.axelor.apps.human.resource.web.TimesheetLineController" method="setVisibleDuration"/>
	</action-method>
</object-views>
