<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_4.0.xsd">

	<grid name="ts-timer-grid" title="Log Times" model="com.axelor.apps.hr.db.TSTimer" editable="true"
	onNew="action-hr-default-timesheet-line-project">
		<field name="user" form-view="user-form" grid-view="user-grid"/>
		<field name="projectTask" form-view="project-task-form" grid-view="project-task-grid"/>
		<field name="product" domain="self.isActivity = true" widget="SuggestBox" form-view="product-activity-form" grid-view="product-activity-grid"/>
		<field name="startTime"/>
		<field name="visibleDuration"/>
		<field name="durationStored" hidden="true"/>
		<field name="affectedToTimeSheetLine" grid-view="timesheet-line-project-grid" form-view="timesheet-line-project-form"/>
		<field name="comments" />
	</grid>

	<form name="ts-timer-form" title="Log Time" model="com.axelor.apps.hr.db.TSTimer"
	onNew="action-hr-default-timesheet-line-project" width="large">
		<panel title="TimeSheet Timer">
			<field name="user" form-view="user-form" grid-view="user-grid"/>
			<field name="projectTask" form-view="project-task-form" grid-view="project-task-grid"/>
			<field name="product" domain="self.isActivity = true" widget="SuggestBox" form-view="product-activity-form" grid-view="product-activity-grid" onChange="action-ts-timer-record-stop" readonlyIf="status == 1"/>
			<field name="startTime"/>
			<field name="duration" widget="duration" colSpan="3"/>
			<label name="durationLabel" title="Hours" colSpan="1"/>
			<field name="affectedToTimeSheetLine" grid-view="timesheet-line-project-grid" form-view="timesheet-line-project-form"/>
			<field name="comments" />
		</panel>
		<panel sidebar="true" title="Actions" stacked="true">
			<button name="start" title="Start" onClick="action-ts-timer-record-start-startTime,save" readonlyIf="status == 1 || product == null"/>
			<button name="stop" title="Stop" onClick="action-ts-timer-record-stop,action-ts-timer-method-calculate-duration,action-ts-timer-method-generate-timesheet-line,save" readonlyIf="status == 2 || product == null"/>		
		</panel>
	</form>
	
	<action-record name="action-hr-default-timesheet-line-project" model="com.axelor.apps.hr.db.TSTimer">
	    <field name="user" expr="eval:__user__" />
	    <field name="product" expr="eval:__user__.employee?.product" />
	</action-record>
	
	<action-record name="action-ts-timer-record-start-startTime" model="com.axelor.apps.hr.db.TSTimer">
		<field name="status" expr="1"/>
		<field name="startTime" expr="eval:__datetime__"/>
	</action-record>
	
	<action-record name="action-ts-timer-record-stop" model="com.axelor.apps.hr.db.TSTimer">
		<field name="status" expr="2"/>
	</action-record>
	
	<action-method name="action-ts-timer-method-calculate-duration">
    	<call class="com.axelor.apps.hr.web.timesheet.timer.TSTimerController" method="calculateDuration" />
    </action-method>
	
</object-views>
