<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_4.0.xsd">
    
    <grid name="stock-move-line-grid" title="Stock move lines" model="com.axelor.apps.stock.db.StockMoveLine" editable="true">
        <field name="productName" required="true" />
        <field name="product" onChange="action-group-stock-stockmoveline-product-onchange" onSelect="action-stock-move-line-product-domain"/>
        <field name="productModel"/>
        <field name="qty" onChange="action-stock-move-line-record-qty"/>
        <field name="realQty"/>
        <field name="unit"/>
        <field name="trackingNumber"/>
        <field name="accordanceSelect"/>
    </grid>
    
    <grid name="stock-move-line-split-grid" title="Stock move lines" model="com.axelor.apps.stock.db.StockMoveLine" editable="true">
        <field name="productName" readonly="true" />
        <field name="product" readonly="true"/>
        <field name="productModel" readonly="true"/>
        <field name="qty"/>
        <field name="unit" readonly="true"/>
        <field name="trackingNumber" readonly="true"/>
        <field name="accordanceSelect" readonly="true"/>
    </grid>
    
    <form name="stock-move-line-form" title="Stock move line" model="com.axelor.apps.stock.db.StockMoveLine"
    	onNew="action-stock-move-line-record-new" onLoad="action-inventory-line-attrs-tracking-number">
        <panel>
            <field name="productName" />
	        <field name="product" domain="self.expense = false" onChange="action-group-stock-stockmoveline-product-onchange" onSelect="action-stock-move-line-product-domain"/>
	        <field name="productModel"/>
	        <field name="qty" onChange="action-stock-move-line-record-qty" colSpan="3"/>
	        <field name="realQty" colSpan="3"/>
	        <field name="unit" colSpan="3"/>
	        <field name="trackingNumber" onChange="action-stock-move-line-record-product"/>
	        <field name="accordanceSelect"/>
	        <field name="businessProject" if-module="axelor-business-project" domain="self.businessProject = true AND self.typeSelect = 'project'" form-view="project-form" grid-view="project-grid"/>
	        <field name="description" colSpan="12" widget="html" />
        </panel>
    </form>
    
    <grid name="stock-move-line-all-grid" title="Stock move lines" model="com.axelor.apps.stock.db.StockMoveLine">
    	<field name="stockMove.stockMoveSeq"/>
    	<field name="stockMove.realDate"/>
        <field name="stockMove.fromLocation"/>
        <field name="stockMove.toLocation"/>
        <field name="productName" />
        <field name="product"/>
        <field name="realQty"/>
        <field name="unit"/>
        <field name="trackingNumber"/>
        <field name="stockMove.statusSelect"/>
    </grid>
    
    <form name="stock-move-line-all-form" title="Stock move line" model="com.axelor.apps.stock.db.StockMoveLine"
    	onNew="action-stock-move-line-record-new" onLoad="action-stock-move-line-attrs-scale-and-precision,action-inventory-line-attrs-tracking-number" readonlyIf="stockMove.statusSelect == 3">
        <panel title="Stock Move">
	    	<field name="stockMove.stockMoveSeq"/>
	    	<field name="stockMove"/>
	    	<field name="stockMove.estimatedDate"/>
	    	<field name="stockMove.realDate"/>
	        <field name="stockMove.fromLocation"/>
	        <field name="stockMove.toLocation"/>
        </panel>
        <panel title="Move details">
            <field name="productName" required="true"/>
	        <field name="product" domain="self.expense = false" onChange="action-group-stock-stockmoveline-product-onchange" onSelect="action-stock-move-line-product-domain"/>
	        <field name="productModel"/>
			<field name="qty" colSpan="3" onChange="action-stock-move-line-record-qty"/>
	        <field name="realQty" colSpan="3"/>
	        <field name="unit" colSpan="3"/>
	        <field name="trackingNumber" onChange="action-stock-move-line-record-product"/>
	        <field name="stockMove.statusSelect" hidden="true"/>
	        <field name="businessProject" if-module="axelor-business-project" domain="self.businessProject = true AND self.typeSelect = 'project'" form-view="project-form" grid-view="project-grid"/>
	        <field name="description" colSpan="12" widget="html" />
        </panel>
    </form>

    <grid name="stock-move-line-production-grid" title="Stock move lines" model="com.axelor.apps.stock.db.StockMoveLine">
        <field name="product"/>
        <field name="productModel"/>
        <field name="qty"/>
        <field name="unit"/>
        <field name="trackingNumber"/>
    </grid>
    
    <form name="stock-move-line-production-form" title="Stock move line" model="com.axelor.apps.stock.db.StockMoveLine"
    	onNew="action-group-stock-stockmoveline-production-onnew" onLoad="action-stock-move-line-attrs-scale-and-precision">
		<panel>
		    <field name="productName" required="true" />
	        <field name="product" domain="self.expense = false" onChange="action-stock-move-line-set-product-info" onSelect="action-stock-move-line-product-domain"/>
	        <field name="productModel"/>
	        <field name="qty" onChange="action-stock-move-line-record-qty"/>
	        <field name="unit"/>
	        <field name="trackingNumber" onChange="action-stock-move-line-record-product"/>
	        <field name="businessProject" if-module="axelor-business-project" domain="self.businessProject = true AND self.typeSelect = 'project'" form-view="project-form" grid-view="project-grid"/>
	        <field name="stockMove" hidden="true"/>
        </panel>
    </form>
    
    <action-group name="action-group-stock-stockmoveline-product-onchange">
    	<action name="action-inventory-line-attrs-tracking-number"/>
    	<action name="action-stock-move-line-set-product-info"/>
    </action-group>
    
    <action-group name="action-group-stock-stockmoveline-production-onnew">
    	<action name="action-stock-move-line-attrs-scale-and-precision"/>
    	<action name="action-stock-move-line-record-new"/>
    	<action name="stock-move-line-production-record-default"/>
    </action-group>
    
    <action-record name="stock-move-line-production-record-default" model="com.axelor.apps.stock.db.StockMoveLine">
    	<field name="stockMove" expr="eval: _parent.inStockMove" if="_parent._model == 'com.axelor.apps.production.db.OperationOrder'"/>
    	<field name="stockMove" expr="eval: _parent.inStockMove" if="_parent._model == 'com.axelor.apps.production.db.ManufOrder' &amp;&amp; _parent?.selectedPage == 'consumedProductPage'"/>
    	<field name="stockMove" expr="eval: _parent.outStockMove" if="_parent._model == 'com.axelor.apps.production.db.ManufOrder' &amp;&amp; _parent?.selectedPage == 'producedProductPage'"/>
    </action-record>
    
    <action-record name="action-stock-move-line-record-new" model="com.axelor.apps.stock.db.StockMoveLine">
	    <field name="qty" expr="1"/>
	    <field name="realQty" expr="1"/>
	</action-record>
	
	<action-record name="action-stock-move-line-record-qty" model="com.axelor.apps.stock.db.StockMoveLine">
		<field name="realQty" expr="eval: qty" if="_parent?.statusSelect &lt;= 2"/>
	</action-record>
	
	<action-record name="action-stock-move-line-set-product-info" model="com.axelor.apps.stock.db.StockMoveLine">
	    <field name="unit" expr="eval: product.unit"/>
	    <field name="price" expr="eval: product.costPrice"/>
	    <field name="productName" expr="eval: product.name"/>
	</action-record>
	
	<action-record name="action-stock-move-line-record-product" model="com.axelor.apps.stock.db.StockMoveLine">
	    <field name="product" expr="eval: trackingNumber.product" if="trackingNumber"/>
	</action-record>
	
	<action-attrs name="action-stock-move-line-product-domain">
		<attribute name="domain" for="product" expr="eval: self.parentProduct.id = :productModel" if="productModel"/>
	</action-attrs>
	
	
	<action-attrs name="action-stock-move-line-attrs-scale-and-precision">
		<attribute name="scale" for="price" expr="eval: GeneralService.getNbDecimalDigitForUnitPrice()"/>
	</action-attrs>
	
</object-views>
