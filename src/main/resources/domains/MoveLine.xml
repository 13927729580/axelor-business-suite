<?xml version="1.0" encoding="UTF-8"?>
<domain-models xmlns="http://apps.axelor.com/xml/ns/domain-models" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://apps.axelor.com/xml/ns/domain-models http://apps.axelor.com/xml/ns/domain-models/domain-models_0.9.xsd">
  
  <module name="account" package="com.axelor.apps.account.db"/>
  
  <entity name="MoveLine" lang="java">
  
    <many-to-one name="move" ref="Move" title="Move"/>
    <date name="date" title="Input Date"/>
    <date name="dueDate" title="Due Date"/>
    <decimal name="debit" title="Debit"/>
    <decimal name="credit" title="Credit"/>
    <many-to-one name="account" ref="Account" required="true" title="Account"/>
    <one-to-many name="reconcileList1" ref="Reconcile" title="Debit Reconcile list" mappedBy="debitMoveLine" readonly="false"/>
    <one-to-many name="reconcileList2" ref="Reconcile" title="Credit Reconcile List" mappedBy="creditMoveLine" readonly="false"/>
    <decimal name="amountPaid" title="Amount paid/reconciled" default="0.0" readonly="true"/>
    <many-to-one name="partner" ref="com.axelor.apps.base.db.Partner" title="Partner"/>
    <string name="counter" title="Line Nbr." help="This sequence is unique per Move, automatically reset to 1 for a new moveline"/>
    <many-to-one name="invoiceReject" ref="com.axelor.apps.account.db.Invoice" title="Invoice rejected"/>
    <boolean name="exportedDirectDebitOk" title="Exported Direct Debit" default="false"/>
    <many-to-one name="interbankCodeLine" ref="com.axelor.apps.account.db.InterbankCodeLine" title="Reject reason"/>
    <string name="description" title="Description"/>
    <many-to-many name="analyticAccountSet" ref="AnalyticAccount" title="Analytic account"/>
    <integer name="mailSelect" title="Mail status" default="0" selection="move.line.mail.select"/>
    <integer name="reimbursementStateSelect" title="Reimbursement status" default="0" selection="move.line.reimbursement.state.select"/>
    <boolean name="unrecocileMoveOk" title="Unreconciled move line" default="false"/>
    <string name="passageReason" title="Irrecoverable Shift Reason" readonly="true"/>
    <boolean name="usherPassageOk" title="Transfer(ed) to Usher "/>
    <many-to-one name="taxLine" ref="com.axelor.apps.account.db.TaxLine" title="Tax" />
   
    <decimal name="currencyRate" title="Currency Rate"/>
    <decimal name="currencyAmount" title="Amount in Currency"/>
    
    <!-- 	Field not displayed, used during the payment voucher input -->
	<decimal name="maxAmountToReconcile" title="Max Amount to reconcile"/>
	<many-to-one name="paymentScheduleLine" ref="com.axelor.apps.account.db.PaymentScheduleLine" title="Payment Schedule line"/>
	
	<!-- 	Field not displayed, used for direct debit only -->
	<decimal name="amountExportedInDirectDebit" title="Amount exported for direct debit"/>
	
	<!--  Field not displayed, used for account clearance -->
	<many-to-one name="accountClearance" ref="com.axelor.apps.account.db.AccountClearance" title="Account clearance"/>
	
	<integer name="irrecoverableStateSelect" title="Irrecoverable status" default="0" readonly="true" selection="iaccount.account.schedule.irrecoverable.state.select"/>
	<many-to-one name="managementObject" ref="com.axelor.apps.account.db.ManagementObject" title="Irrecoverable shift reason"/>
    
    <string name="name" title="Name" namecolumn="true">
    	<![CDATA[
    	if (move != null){
    		if (counter != null){
    			if (move.getReference() != null){
    				return move.getReference() + "-" + counter;
    			}
    			else return counter;
    		}
    		else return "-";
    	}
		else {
			if (counter != null) return counter;
		 	else return "-";
		 }
	    ]]>
    </string>
    <decimal name="amountRemaining" title="To pay / To use" >
    	<![CDATA[
    	if (account != null && account.getReconcileOk()){
		    if (credit.compareTo(BigDecimal.ZERO) == 1) return credit.subtract(amountPaid);
		    else if (debit.compareTo(BigDecimal.ZERO) == 1) return debit.subtract(amountPaid);
		    else return BigDecimal.ZERO;
	    }
		else return BigDecimal.ZERO;
	    ]]>
    </decimal>
    <many-to-one name="invoice" ref="com.axelor.apps.account.db.Invoice" title="Invoice">
	    <![CDATA[
 		    if (move != null && move.getInvoice() != null) return move.getInvoice();
		    else return null;
 	     ]]>
    </many-to-one>
  
  </entity>

</domain-models>
