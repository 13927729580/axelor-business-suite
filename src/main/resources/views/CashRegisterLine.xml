<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://apps.axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://apps.axelor.com/xml/ns/object-views http://apps.axelor.com/xml/ns/object-views/object-views_2.1.xsd">
    
    <grid name="cash-register-line-grid" title="Cash register closing" model="com.axelor.apps.account.db.CashRegisterLine">
        <field name="user"/>
        <field name="cashRegister"/>
        <field name="createDateTime"/>
        <field name="cashRegisterDate"/>
        <field name="cashRegisterAmount"/>
        <field name="depositedAmount"/>
        <field name="stateSelect"/>
    </grid>
    
   <form cols="4" onLoad="action-account-cash-registerline-onload-group" onNew="action-account-cash-registerline-onnew-group" name="cash-register-line-form" title="Cash register closing" model="com.axelor.apps.account.db.CashRegisterLine">
  <panel title="Overview">
    <field name="stateSelect"/>
    <field name="user"/>
    <field name="createDateTime"/>
     <field name="cashRegister"/>
    <field name="cashRegisterDate"/>
  </panel> 
   
  
  <panel title="Amounts to register" >
    <field name="cashRegisterAmount"/>
    <field name="depositedAmount"/>
  </panel>
  <panel title="Follow-up" >
    <field name="emailSentOk"/>
  </panel>
  <panel-side title="Actions">
      <button name="closeCashRegister" title="Close cashier" colSpan="2" onClick="action-group-account-cash-registerline-close-click"/>
      <button name="openCashRegister" title="Open cashier" colSpan="2" onClick="action-group-account-cash-registerline-open-click"/>
    </panel-side>
</form>

    
    <action-group name="action-account-cash-registerline-onnew-group">
	    <action name="action-cash-register-line-record-new"/>
	    <action name="action-cash-register-line-attrs-hidden-button"/>
    </action-group>
    
    <action-group name="action-account-cash-registerline-onload-group">
	    <action name="action-cash-register-line-attrs-hidden-button"/>
	    <action name="action-cash-register-line-attrs-readonly"/>
    </action-group>
    
    <action-group name="action-group-account-cash-registerline-close-click">
    	<action name="save"/>
    	<action name="action-method-account-cash-registerline-close"/>
    	<action name="action-cash-register-line-attrs-hidden-button"/>
    	<action name="save"/>
    </action-group>
    
    <action-group name="action-group-account-cash-registerline-open-click">
    	<action name="save"/>
    	<action name="action-method-account-cash-registerline-open"/>
    	<action name="action-cash-register-line-attrs-hidden-button"/>
    	<action name="save"/>
    </action-group>
    
    <action-method name="action-method-account-cash-registerline-close">
    	<call class="com.axelor.apps.account.web.CashRegisterController" method="closeCashRegister"/>
    </action-method>
    
    <action-method name="action-method-account-cash-registerline-open">
    	<call class="com.axelor.apps.account.web.CashRegisterController" method="openCashRegister"/>
    </action-method>

    <action-record name="action-cash-register-line-record-new" model="com.axelor.apps.account.db.CashRegisterLine">
    	<field name="user" expr="eval:__user__"/>
    	<field name="cashRegister"   expr="eval:__user__.activeCashRegister"/>
    	<field name="createDateTime" expr="call:com.axelor.apps.base.service.administration.GeneralService:getTodayDateTime()"/>
    	<field name="cashRegisterDate" expr="call:com.axelor.apps.base.service.administration.GeneralService:getTodayDate()"/>
    	<field name="stateSelect" expr="0"/>
    </action-record>
    
    <action-attrs name="action-cash-register-line-attrs-hidden-button">
    	<attribute name="hidden" for="closeCashRegister" expr="eval: emailSentOk || (stateSelect == 1)"/>
      	<attribute name="hidden" for="openCashRegister" expr="eval: emailSentOk || (stateSelect == 0)"/>	
    </action-attrs>

	<action-attrs name="action-cash-register-line-attrs-readonly">
		<attribute name="readonly" for="cashRegister" expr="eval: emailSentOK "/>
		<attribute name="readonly" for="cashRegisterDate" expr="eval: emailSentOK "/>
		<attribute name="readonly" for="cashRegisterAmount" expr="eval: emailSentOK "/>
		<attribute name="readonly" for="depositedAmount" expr="eval: emailSentOK "/>
	</action-attrs>

</object-views>