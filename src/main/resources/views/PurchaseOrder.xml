<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://apps.axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://apps.axelor.com/xml/ns/object-views http://apps.axelor.com/xml/ns/object-views/object-views_0.9.xsd">
    
    <grid name="purchase-order-grid" title="Supplier RFQs/POs" model="com.axelor.apps.supplychain.db.PurchaseOrder">
    	<field name="purchaseOrderSeq"/>
        <field name="supplierPartner"/>
        <field name="affairProject"/>
        <field name="buyerUserInfo"/>
        <field name="statusSelect"/>
    </grid>
    
    <form name="purchase-order-form" title="Supplier RFQ/PO" model="com.axelor.apps.supplychain.db.PurchaseOrder" cols="4" onNew="action-purchase-order-record-new,action-purchase-order-record-company-configuration"
    onSave="action-purchase-order-set-sequence">
    	<field name="purchaseOrderSeq"/>
    	<field name="company" widget="SuggestBox" onChange="action-purchase-order-record-company-configuration"/>
   	 	<field name="supplierPartner" domain="self.partnerTypeSelect = 1" onChange="action-purchase-order-record-partner"/>
   	 	<field name="statusSelect" widget="NavSelect"/>
        <field name="affairProject"/>
        <field name="buyerUserInfo"/>
        <field name="orderDate"/>
        <field name="deliveryDate"/>
        <field name="currency"/>
        <field name="invoicingTypeSelect"/>
        <field name="invoice" hideIf="invoicingTypeSelect == 2"/>
		<field name="purchaseOrderLineList" colSpan="4" grid-view="purchase-order-line-grid" form-view="purchase-order-line-form"/>
        <field name="purchaseOrderLineVatList" colSpan="4"/>
      	<group colSpan="4" cols="3" showTitle="false">
       		<group colSpan="2" cols="2" title="Action(s)">
       			<group colSpan="1" cols="1">
       				<button name="compute" title="Compute" colSpan="1" onClick="save,action-purchase-order-method-compute,save" hideIf="statusSelect == 4"/>
	                <button name="validate" title="Validate" colSpan="1" onClick="save,action-purchase-order-record-validate,save" showIf="statusSelect == 3"/>
	                <button name="cancel" title="Cancel" colSpan="1" onClick="save,action-purchase-order-record-cancel" showIf="statusSelect == 1 || statusSelect == 2"/>
	                <button name="sendByEmail" title="Send by email" colSpan="1" showIf="statusSelect == 4"/>
			    	<button name="generateDeliveryOrder" title="Generate delivery" colSpan="1"/>
			    	<button name="showSupplierInvoice" title="Show invoice" colSpan="1" onClick="action-purchase-order-show-supplier-invoice"/>
			    	<button name="generateControlInvoice" title="Generate control invoice" onClick="action-purchase-order-validate-generate-control-invoice,save,action-purchase-order-method-generate-control-invoice" colSpan="1" />
       			</group>
       			<group colSpan="1" cols="2" readonly="true">
       				<field name="validatedByUserInfo" colSpan="1"/>
                	<field name="validationDate" colSpan="1"/>
       			</group>
      			</group>
      			<group colSpan="1" cols="1" title="Totals">
        		<group colSpan="1" css="subtotal" cols="2" colWidths="50%,50%" readonly="true">
        			<field name="exTaxTotal"/>
        			<field name="vatTotal"/>
        			<field name="inTaxTotal" css="subtotal-total"/>
		        	<field name="amountRemainingToBeInvoiced"/>
        		</group>
       		</group>
      	</group>
    </form>
    
    <action-record name="action-purchase-order-record-new" model="com.axelor.apps.supplychain.db.PurchaseOrder">
    	<field name="statusSelect" expr="1"/>
    	<field name="invoicingTypeSelect" expr="1"/>
    	<field name="company" expr="call:com.axelor.apps.base.service.user.UserInfoService:getUserActiveCompany()"/>
    	<field name="buyerUserInfo" expr="call:com.axelor.apps.base.service.user.UserInfoService:getUserInfo()"/>
    	<field name="orderDate" expr="eval: __date__"/>
    </action-record>
    
    <action-record name="action-purchase-order-record-company-configuration" model="com.axelor.apps.supplychain.db.PurchaseOrder">
	    <field name="currency" expr="eval: company?.currency"/>
	    <field name="invoicingTypeSelect" expr="eval: company?.purchaseOrderInvoicingTypeSelect" if="eval: company?.purchaseOrderInvoicingTypeSelect != 0"/>
	</action-record>
	
    <action-record name="action-purchase-order-record-partner" model="com.axelor.apps.supplychain.db.PurchaseOrder">
 		<field name="currency" expr="eval: supplierPartner?.currency"/>
 	</action-record>
    
    <action-record name="action-purchase-order-record-validate" model="com.axelor.apps.supplychain.db.PurchaseOrder">
    	<field name="statusSelect" expr="eval: 4"/>
    	<field name="validationDate" expr="eval: __date__"/>
    	<field name="validatedByUserInfo" expr="call:com.axelor.apps.base.service.user.UserInfoService:getUserInfo()"/>
    </action-record>
    
     <action-record name="action-purchase-order-record-cancel" model="com.axelor.apps.supplychain.db.PurchaseOrder">
    	<field name="statusSelect" expr="eval: 6"/>
    </action-record>
    
    <action-method name="action-purchase-order-method-compute">
    	<call class="com.axelor.apps.supplychain.web.PurchaseOrderController" method="compute"/>
    </action-method>
 	
 	<action-method name="action-purchase-order-set-sequence">
 		<call class="com.axelor.apps.supplychain.web.PurchaseOrderController" method="setSequence"/>
 	</action-method>
    
    <action-method name="action-purchase-order-method-generate-control-invoice">
 		<call class="com.axelor.apps.supplychain.web.PurchaseOrderInvoiceController" method="generateInvoice"/>
	</action-method>
	
    <action-view name="action-purchase-order-show-supplier-invoice" title="Supplier invoices"
		model="com.axelor.apps.account.db.Invoice">
		<view type="grid" name="invoice-grid"/>
		<view type="form" name="invoice-form"/>
		<domain>self.operationTypeSelect = 1</domain>
		<context name="operationTypeSelect" expr="1"/>
	</action-view>
    
    <action-validate name="action-purchase-order-validate-generate-control-invoice">
   		<error message="Generating invoice is impossible, the fields 'Supplier' and 'Company' must be filled." if="supplierPartner == null || company == null"/>
	</action-validate> 

</object-views>
