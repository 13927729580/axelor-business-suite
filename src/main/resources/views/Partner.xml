<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://apps.axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://apps.axelor.com/xml/ns/object-views http://apps.axelor.com/xml/ns/object-views/object-views_0.9.xsd">
    
    <grid name="partner-grid" title="Partners" model="com.axelor.apps.base.db.Partner">
    	<toolbar>
			<button name="fbContact" title="Facebook Contact" icon="img/facebook.jpg"
				onClick="com.axelor.sn.web.PartnerImportController:importFBContacts" />
			<button name="twtContact" title="Twitter Contact" icon="img/twitterLogo.png"
				onClick="com.axelor.sn.web.PartnerImportController:importTWTContacts" />
			<button name="linContact" title="LinkedIn Contact" icon="img/linkedin-icon-vector.jpg"
				onClick="com.axelor.sn.web.PartnerImportController:importLINContacts" />
		</toolbar>
        <field name="name"/>
        <field name="firstName"/>
        <field name="fullName"/>
        <field name="mainInvoicingAddress"/>
        <field name="isContact"/>
   		<field name="partnerTypeSelect"/>
        <field name="partnerCategory"/>
        <field name="snType"/>
    </grid>
    
    <grid name="partner-contact-grid" title="Contacts" model="com.axelor.apps.base.db.Partner">
        <field name="name"/>
        <field name="firstName"/>
        <field name="fullName"/>
        <field name="mainInvoicingAddress"/>
        <field name="fixedPhone1"/>
		<field name="fixedPhonePro"/>
		<field name="mobilePhonePerso"/>
		<field name="mobilePhonePro"/>
        <field name="email"/>
    </grid>
    
    <form cols="4" colWidths="25*"   name="partner-form" title="Partner" model="com.axelor.apps.base.db.Partner"
	    onNew="action-partner-record-partner-type-select,action-partner-record-set-default" 
	    onLoad="action-partner-attrs-change-name,action-partner-attrs-hide-tabs" 
	    onSave="action-set-partner-seq">
	    <group colSpan="1">
	        <field name="picture"/>
	    </group>
	    <group colSpan="3" cols="6">
	        <field name="name" css="subtotal-total"/>
	        <field name="firstName" hideIf="partnerTypeSelect != 2" css="subtotal-total"/>
	        <field name="titleSelect" hideIf="partnerTypeSelect != 2" css="subtotal-total"/>
	        <break/>
	        <field name="partnerCategory" widget="SuggestBox"/>
	        <field name="partnerTypeSelect" onChange="action-partner-attrs-change-name,action-partner-attrs-hide-tabs"/>
	        <field name="parentPartner" hideIf="partnerTypeSelect != 1"/>
	        <field name="isContact" hideIf="partnerTypeSelect != 2" onChange="action-partner-set-non-contact-fields,action-partner-attrs-hide-tabs"/>
	        <field name="isCustomer"/>
	        <field name="customerTypeSelect" hideIf="isContact || !isCustomer"/>        
	        <field name="isSupplier" hideIf="partnerTypeSelect == 2"/>
	        <field name="supplierTypeSelect" hideIf="isContact || !isSupplier"/>
	        <break/>
	    </group>
	    <field name="contactPartnerSet" hideIf="isContact || partnerTypeSelect == 2" colSpan="4" domain="self.isContact = 'true'" grid-view="partner-contact-grid"/>
	    <field name="snUserId" hidden="true" />
		<field name="snType" hidden="true" />
		<field name="curUser" hidden="true" />
	    <break/>
	    <notebook colSpan="4">
	        <page name="information" title="Informations">
	            <group title="Partner details" colSpan="3" cols="4">
	                <field name="site"/>
	                <field name="department"/>
	                <field name="source" hideIf="isContact"/>
	            </group>
	            <group title="Postal addresses" colSpan="3" cols="4">
	                <field name="deliveryAddress" onChange="action-partner-record-main-invoicing-address"/>
	                <field name="mainInvoicingAddress"/>
	            </group>
	            <group title="Contact" colSpan="3" cols="4">
	                <field name="email"/>
	                <field name="fax"/>
	                <field name="fixedPhone1"/>
	                <field name="fixedPhone2"/>
	                <field name="fixedPhonePro"/>
	                <field name="mobilePhonePerso"/>
	                <field name="mobilePhonePro"/>
	                <field name="webSite"/>
	            </group>
	        </page>
	        <page title="Links">
	            <group colSpan="4" cols="6">
	                <button name="showSalesOrder1" title="Voir les devis" hideIf="isContact" colSpan="2" onClick="save,action-partner-view-partner-sales-order"/>
	                <button name="showInvoice1" title="Voir les factures" hideIf="isContact" colSpan="2" onClick="save,action-partner-view-partner-invoice"/>
	                <button name="showProject1" title="Voir les projets" hideIf="isContact" colSpan="2" onClick="save,action-partner-view-partner-project"/>
	            </group>
	            <group colSpan="4" cols="6">
	                <button name="showSalesOrder2" title="Voir les devis" showIf="isContact" colSpan="2" onClick="save,action-partner-view-contact-sales-order"/>
	                <button name="showInvoice2" title="Voir les factures" showIf="isContact" colSpan="2" onClick="save,action-partner-view-contact-invoice"/>
	                <button name="showProject2" title="Voir les projets" showIf="isContact" colSpan="2" onClick="save,action-partner-view-contact-project"/>
	            </group>
	            <portlet colSpan="2" action="action-partner-view-partner-event"/>
	            <portlet colSpan="2" action="action-partner-view-partner-opportunities"/>
	        </page>
	<!--         <page name="payment" title="Invoicing/Payment" cols="4"> -->
	<!--             <field name="invoiceSendingFormatSelect"/> -->
	<!--             <field name="paymentMode"/> -->
	<!--             <field name="paymentCondition"/> -->
	<!--             <field name="currency"/> -->
	<!--             <field name="payerQuality"/> -->
	<!--             <field name="bankDetails"/> -->
	<!--             <field name="bankDetailsList" noLabel="true" colSpan="4" form-view="bank-details-form" grid-view="bank-details-grid"/> -->
	<!--             <button name="showInvoice" title="View all unpaid invoices" colSpan="2" onClick="save,action-partner-method-show-invoice"/> -->
	<!--         </page> -->
	        <page title="Settings">
	            <field name="companySet" colSpan="4" widget="TagSelect[create=name]"/>
	            <field name="partnerSeq"/>
	            <field name="languageSelect" hideIf="isContact || partnerTypeSelect == 1"/>
	            
	        </page>
	        <page title="Social Networking" colSpan="4" name="socialNetworkingTab"
				hideIf="snType == null">
				<notebook>
					<page title="Inbox Message">
						<portlet action="action-fetch-all-sn-mail" colSpan="4" />
					</page>
					<page title="Recent Updates">
						<portlet action="action-fetch-all-sn-update" colSpan="4" />
					</page>

					<page title="Send Personal Message" name="snPersonalMessage"
						hideIf="snType.name == 'facebook'">
						<field name="snDirectMessage" title="Personal Messages"><!-- 
								onChange="com.axelor.sn.web.TWTController:directMessageO2M"> -->
							<grid title="All Sent Messages">
								<field name="snType" title="Social Networking Type"
									hidden="true"></field>
								<field name="userId" title="To"></field>
								<field name="messageText"></field>
								<field name="messageDate" title="Date and Time" hidden="true"></field>
								<field name="messageId" />
							</grid>

							<form title="Compose New Message" onNew="action-fill-direct-message">
								<field name="snType" title="Social Networking Type"
									hidden="true"></field>
								<field name="curUser" title="Current User" hidden="true"></field>
								<field name="userId" title="To" readonly="true"></field>
								<break />
								<field name="subject" hideIf="snType.name != 'linkedin'"></field>
								<break />
								<field name="messageText" required="true"
									/> <!--  onChange="com.axelor.sn.web.SNCommonController:sendMessage"></field>-->
								<break/>
								<spacer colSpan="1"/>
								<button name="firePersonalMsg"
									onClick="com.axelor.sn.web.SNCommonController:sendMessage"
									title="Send" />
								<field name="messageDate" title="Date and Time" hidden="true"></field>
								<field name="messageId" hidden="true" />
							</form>
						</field>
					</page>
				</notebook>
			</page>
			<page title="Reporting">
				<group title="Action(s)" colSpan="2" cols="2">
                    <group colSpan="1" cols="1">
                        <button name="showPartnerInfo" title="Print Informations" colSpan="1" icon="img/icons/print.png" onClick="save,action-partner-method-show-partner-info"/>
                    </group>
                </group>
			</page>
	<!--         <page name="compteClient" title="Customer balance"> -->
	<!--             <field name="accountingSituationList" colSpan="4" widget="MasterDetail" onSelect="action-account-accounting-situation-method-update-customer-account"/> -->
	<!--         </page> -->
	<!--         <page name="reportedBalance" title="Reported balance"> -->
	<!--             <field name="reportedBalanceList" colSpan="4"> -->
	<!--                 <grid name="reported-balance-grid" title="Reported balances" model="com.axelor.apps.account.db.ReportedBalance"> -->
	<!--                     <field name="company"/> -->
	<!--                 </grid> -->
	<!--                 <form cols="4" name="reported-balance-form" title="Reported balance" model="com.axelor.apps.account.db.ReportedBalance"> -->
	<!--                     <field name="company"/> -->
	<!--                     <field name="reportedBalanceLineList" colSpan="4"> -->
	<!--                         <grid name="reported-balance-line-grid" title="Reported balance lines" model="com.axelor.apps.account.db.ReportedBalanceLine"> -->
	<!--                             <field name="year"/> -->
	<!--                             <field name="amount"/> -->
	<!--                         </grid> -->
	<!--                         <form cols="4" name="reported-balance-line-form" title="Reported balance line" model="com.axelor.apps.account.db.ReportedBalanceLine"> -->
	<!--                             <field name="year"/> -->
	<!--                             <field name="amount"/> -->
	<!--                         </form> -->
	<!--                     </field> -->
	<!--                 </form> -->
	<!--             </field> -->
	<!--         </page> -->
	    </notebook>
	</form>
	
    
    <action-method name="action-partner-method-show-partner-info">
		<call class="com.axelor.apps.base.web.PartnerControllerSimple" method="showPartnerInfo"/>
	</action-method>
    
    <action-view name="action-partner-view-partner-invoice" title="Invoices" model="com.axelor.apps.account.db.Invoice">
		<view type="grid" name="invoice-grid"/>
		<view type="form" name="invoice-form"/>
		<domain>self.partner.id = :id</domain>
		<context name="id" expr="eval: id"/>
	</action-view>
	
	<action-view name="action-partner-view-contact-invoice" title="Invoices" model="com.axelor.apps.account.db.Invoice">
		<view type="grid" name="invoice-grid"/>
		<view type="form" name="invoice-form"/>
		<domain>self.contactPartner.id = :id</domain>
		<context name="id" expr="eval: id"/>
	</action-view>
	
	<action-view name="action-partner-view-partner-sales-order" title="Sales orders" model="com.axelor.apps.supplychain.db.SalesOrder">
		<view type="grid" name="sales-order-grid"/>
		<view type="form" name="sales-order-form"/>
		<domain>self.clientPartner.id = :id</domain>
		<context name="id" expr="eval: id"/>
	</action-view>
	
	<action-view name="action-partner-view-contact-sales-order" title="Sales orders" model="com.axelor.apps.supplychain.db.SalesOrder">
		<view type="grid" name="sales-order-grid"/>
		<view type="form" name="sales-order-form"/>
		<domain>self.contactPartner.id = :id</domain>
		<context name="id" expr="eval: id"/>
	</action-view>
	
	<action-view name="action-partner-view-partner-project" title="Projects" model="com.axelor.apps.organisation.db.Project">
		<view type="grid" name="project-grid"/>
		<view type="form" name="project-form"/>
		<domain>self.clientPartner.id = :id</domain>
		<context name="id" expr="eval: id"/>
	</action-view>
	
	<action-view name="action-partner-view-contact-project" title="Projects" model="com.axelor.apps.organisation.db.Project">
		<view type="grid" name="project-grid"/>
		<view type="form" name="project-form"/>
		<domain>self.contactPartner.id = :id</domain>
		<context name="id" expr="eval: id"/>
	</action-view>
	
	 <action-view name="action-partner-view-partner-event" title="Events" model="com.axelor.apps.crm.db.Event">
		<view type="grid" name="event-grid"/>
		<view type="form"/>
		<domain>self.relatedToSelect = 'com.axelor.apps.base.db.Partner' AND self.relatedToSelectId = :id</domain>
		<context name="id" expr="eval: id"/>
	</action-view>
	
	<action-view name="action-partner-view-partner-opportunities" title="Opportunities" model="com.axelor.apps.crm.db.Opportunity">
		<view type="grid" name="opportunity-grid"/>
		<view type="form" name="opportunity-form"/>
		<domain>self.relatedToSelect = 'com.axelor.apps.base.db.Partner' AND self.relatedToSelectId = :id</domain>
		<context name="id" expr="eval: id"/>
	</action-view>
    
    
    <action-record name="action-partner-record-main-invoicing-address" model="com.axelor.apps.base.db.Partner">
    	<field name="deliveryAddress" expr="eval: mainInvoicingAddress"/>
    </action-record>
    
 	<action-attrs name="action-partner-attrs-change-name">
		<attribute name="title" for="name" expr="Raison sociale" if="partnerTypeSelect != 2"/>
    	<attribute name="title" for="name" expr="Nom" if="partnerTypeSelect == 2"/>
		<attribute name="required" for="name" expr="true"/>	
	</action-attrs>
	
	<action-attrs name="action-partner-attrs-hide-tabs">
		<attribute name="hidden" for="payment" expr="eval:isContact &amp;&amp; partnerTypeSelect == 2"/>	
		<attribute name="hidden" for="compteClient" expr="eval:isContact &amp;&amp; partnerTypeSelect == 2"/>	
		<attribute name="hidden" for="reportedBalance" expr="eval:isContact &amp;&amp; partnerTypeSelect == 2"/>
		<attribute name="required" for="currency" expr="eval:!isContact || partnerTypeSelect != 2"/>
	</action-attrs>

	<action-record name="action-partner-record-partner-type-select" model="com.axelor.apps.base.db.Partner">
    	<field name="partnerTypeSelect" expr="eval:_partnerTypeSelect"/>
    </action-record>
    <action-record name="action-partner-record-set-default" model="com.axelor.apps.base.db.Partner">
    	<field name="isCustomer" expr="eval:true" />
    	<field name="isSupplier" expr="eval:partnerTypeSelect != 2"/>
    	<field name="currency" expr="eval:com.axelor.apps.base.db.UserInfo.all().filter('internalUser = ?1',__user__).fetchOne()?.activeCompany?.currency" if="!isContact"/>
    	<field name="invoiceSendingFormatSelect" expr="eval:'emailpaper'" if="!isContact"/>
    </action-record>
     <action-record name="action-partner-set-non-contact-fields" model="com.axelor.apps.base.db.Partner">
    	<field name="currency" expr="eval:null" if="!isContact"/>
    	<field name="invoiceSendingFormatSelect" expr="eval:null" if="!isContact"/>
    </action-record>

	<!--SN Actions -->    
    <action-view name="action-fetch-all-sn-update" title="Recents Update of User" model="com.axelor.apps.base.db.FBNewsFeed"> 
		<view type="grid" name="fb-news-feed" />
		<domain>self.snUserId = :snUserId</domain>
	</action-view>

	<action-record name="action-fill-direct-message"
		model="com.axelor.apps.base.db.SnSendMessage">
		<field name="snType" expr="eval:_parent.snType" />
		<field name="curUser" expr="eval:__user__" />
		<field name="userId" expr="eval:_parent" />
		<field name="messageDate" expr="eval:__datetime__" />
	</action-record>

	<action-view name="action-fetch-all-sn-mail" title="Inbox"
		model="com.axelor.apps.base.db.MsgInbox">
		<view type="grid" name="sn-msg-inbox-grid" />
		<domain>self.messageFromID = :snUserId</domain>
	</action-view>
	<!--END SN Actions -->
	
	<action-method name="action-set-partner-seq" >
		<call class="com.axelor.apps.base.web.PartnerControllerSimple" method="setPartnerSequence"/>
	</action-method>
</object-views>
