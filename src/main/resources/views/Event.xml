<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://apps.axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://apps.axelor.com/xml/ns/object-views http://apps.axelor.com/xml/ns/object-views/object-views_0.9.xsd">
    
    <grid name="event-grid" title="Events" model="com.axelor.apps.crm.db.Event">
        <field name="typeSelect"/>
        <field name="subject"/>
        <field name="startDateTime"/>
        <field name="durationHours"/>
        <field name="userInfo"/>
        <field name="team"/>
    </grid>
    
    
    <grid name="call-grid" title="Calls" model="com.axelor.apps.crm.db.Event">
        <field name="subject"/>
        <field name="primaryStatusSelect"/>
        <field name="secondaryStatusSelect"/>
        <field name="startDateTime"/>
        <field name="relatedToSelect"/>
        <field name="reminder"/>
    </grid>
    
    <form name="call-form" title="Call" model="com.axelor.apps.crm.db.Event" cols="2" colWidths="*,400"
    	onNew="action-event-new-record">
        <group title="Informations" cols="4" colSpan="1">
        	<field name="subject" colSpan="2"/>
	        <field name="primaryStatusSelect" colSpan="2"/>
	        <field name="secondaryStatusSelect" noLabel="true" colSpan="1"/>
	        <spacer/><break/>
	        <group title="Meeting date" colSpan="4" cols="3" css="groupTitle">
	        	<field name="startDateTime" colSpan="2"/>
	         	<field name="durationHours" colSpan="2"/>
		        <field name="durationMinutesSelect" noLabel="true" colSpan="1"/>
	        </group>
	        <spacer/><break/>
	        <field name="description" widget="TEXT[height=4]" colSpan="4"/>
	        <field name="reminder"/>
        </group>
        <group title="Related to" colSpan="1" cols="2">
	        <field name="relatedToSelect" widget="RefSelect[related=relatedToSelectId]"/>
        </group>
        <group title="Assignment" cols="4" colSpan="2" canCollapse="true">
	        <field name="userInfo"/>
	    	<field name="team"/>
        </group>
    </form>
    
  <calendar name="meeting-calendar" title="Meetings" mode="month" colorBy="userInfo" 
    eventStart="startDateTime" 
    eventStop="endDateTime" 
    eventLength="1">
    <field name="subject" />
  </calendar>
    
    
    <grid name="meeting-grid" title="Meetings" model="com.axelor.apps.crm.db.Event" >
        <field name="subject"/>
        <field name="secondaryStatusSelect"/>
        <field name="startDateTime"/>
        <field name="relatedToSelect"/>
        <field name="reminder"/>
    </grid>
    
    <form name="meeting-form" title="Meeting" model="com.axelor.apps.crm.db.Event" cols="2" colWidths="*,400" 
    	onNew="action-event-new-record">
        <group title="Informations" cols="4" colSpan="1">
        	<field name="subject"/>
	        <field name="secondaryStatusSelect"/>
	        <spacer/><break/>
	        <group title="Meeting date" colSpan="4" cols="4" colWidths="25*" css="groupTitle">
		        <field name="startDateTime" onChange="action-meeting-method-compute-start-date-time"/>
		        <field name="endDateTime" onChange="action-meeting-method-compute-end-date-time"/>
		        <field name="durationHours" onChange="action-meeting-method-compute-duration"/>
		        <field name="durationMinutesSelect" noLabel="true" colSpan="1"/>
	        </group>
	       	<spacer/><break/>
	        <field name="location"/>
	        <field name="reminder"/>
	        <field name="description" widget="TEXT[height=4]" colSpan="4"/>
        </group>
        <group title="Related to" colSpan="1" cols="2">
	        <field name="relatedToSelect" widget="RefSelect[related=relatedToSelectId]"/>
        </group>
        <group title="Assigned to" cols="4" colSpan="2" canCollapse="true">
	        <field name="userInfo"/>
	    	<field name="team"/>
        </group>
    </form>
    
    <grid name="crm-task-grid" title="Tasks" model="com.axelor.apps.crm.db.Event">
        <field name="subject"/>
        <field name="thirdaryStatusSelect"/>
        <field name="startDateTime"/>
        <field name="relatedToSelect"/>
        <field name="reminder"/>
    </grid>
    
    <form name="crm-task-form" title="Task" model="com.axelor.apps.crm.db.Event" cols="2" colWidths="*,400"
    	onNew="action-event-new-record">
        <group title="Informations" cols="4" colSpan="1">
        	<field name="subject"/>
	        <field name="tertiaryStatusSelect"/>
	        <spacer/><break/>
         	<group title="Task date" colSpan="4" cols="4" colWidths="25*" css="groupTitle">
		        <field name="startDateTime" onChange="action-meeting-method-compute-start-date-time"/>
		        <field name="endDateTime" onChange="action-meeting-method-compute-end-date-time"/>
		        <field name="durationHours" onChange="action-meeting-method-compute-duration"/>
	        </group>
	        <spacer/><break/>
	        <field name="taskPartner"/>
	        <field name="reminder"/>
	        <field name="description" widget="TEXT[height=4]" colSpan="4"/>
        </group>
        <group title="Related to" colSpan="1" cols="2">
	        <field name="relatedToSelect" widget="RefSelect[related=relatedToSelectId]"/>
        </group>
        <group title="Assigned to" cols="4" colSpan="2" canCollapse="true">
	        <field name="userInfo"/>
	    	<field name="team"/>
        </group>
    </form>
    
    
     <grid name="ticket-grid" title="Ticket" model="com.axelor.apps.crm.db.Event" orderBy="ticketNumberSeq">
     	<field name="ticketNumberSeq"/>
        <field name="subject"/>
        <field name="eventCategory"/>
        <field name="startDateTime"/>
        <field name="prioritySelect"/>
        <field name="userInfo"/>
        <field name="description"/>
        <field name="progressSelect" widget="Progress"/>
    </grid>
    
    <form name="ticket-form" title="Ticket" model="com.axelor.apps.crm.db.Event" cols="6" colWidths="*,400"
    	onNew="action-event-new-record">
    	<group colSpan="6" cols="6"  colWidths="16%,17%,16%,17%,16%,18%">
	    	<field name="ticketNumberSeq"/>
	       	<field name="subject"/>
	       	<field name="eventCategory" domain="self.typeSelect = :typeSelect"/>
	       	<field name="quaternaryStatusSelect"/>
	       	<field name="prioritySelect"/>
	       	<group colSpan="2">
				<field name="progressSelect" widget="Progress" showIf="$readonly()"/>
				<field name="progressSelect" hideIf="$readonly()"/>
			</group>
	        <break/>
    	</group>
    	<group colSpan="6" cols="6">
   			<group title="Ticket date" colSpan="2" cols="2" colWidths="40%,60%">
		        <field name="startDateTime"/>
		        <field name="endDateTime" title="DeadLine"/>
		        <field name="durationHours"/>
	        </group>
	        <group title="Related to" colSpan="2" cols="2"  colWidths="40%,60%">
	        	<field name="project"/>
	        	<field name="task"/>
	        	<field name="isTimesheetAffected"/>
	        </group>
	        <group colSpan="2" cols="2"  colWidths="40%,60%">
	        	<field name="userInfo"/>
	        	<field name="responsibleUserInfo"/>
	        </group>
    	</group>
        <notebook colSpan="6">
        	<page title="Description" >
        		<field name="description" widget="TEXT[height=4]" noLabel="true" colSpan="6"/>
        	</page>
        	<page title="Comments">
        		<field name="messageList" noLabel="true" colSpan="6"/>
        	</page>
        	<page title="Watchers">
        		<field name="userInfoSet" noLabel="true" colSpan="6"/>
        	</page>
        </notebook>
    </form>
    
    <action-record name="action-event-default-record-userinfo" model="com.axelor.apps.crm.db.Event">
    	<field name="userInfo" expr="call:com.axelor.apps.base.service.user.UserInfoService:getUserInfo()" if="typeSelect == 1 || typeSelect == 2 || typeSelect == 3 || typeSelect == 5"/>
    	<field name="responsibleUserInfo" expr="call:com.axelor.apps.base.service.user.UserInfoService:getUserInfo()" if="typeSelect == 5"/>
   		<field name="team" expr="call:com.axelor.apps.base.service.user.UserInfoService:getUserActiveTeam()"/>
    </action-record>
    
    
    <action-record name="action-event-default-record" model="com.axelor.apps.crm.db.Event">
    	<field name="startDateTime" expr="eval: __time__" if="startDateTime == null"/>
    	<field name="typeSelect" expr="eval: _typeSelect"/>
    </action-record>
    
    <action-method name="action-meeting-method-compute-start-date-time">
    	<call class="com.axelor.apps.crm.web.EventController" method="computeStartDateTime"/>
    </action-method>
    
    <action-method name="action-meeting-method-compute-end-date-time">
    	<call class="com.axelor.apps.crm.web.EventController" method="computeEndDateTime"/>
    </action-method>
    
    <action-method name="action-meeting-method-compute-duration">
    	<call class="com.axelor.apps.crm.web.EventController" method="computeDuration"/>
    </action-method>
    
    <action-record name="action-task-record-tertiary-status-select" model="com.axelor.apps.crm.db.Event">
    	<field name="tertiaryStatusSelect" expr="1" if="typeSelect == 3"/>
    </action-record>
    
    <action-record name="action-event-record-secondary-status-select" model="com.axelor.apps.crm.db.Event">
    	<field name="secondaryStatusSelect" expr="1" if="typeSelect == 1 || typeSelect == 2"/>
    </action-record>
    
    <action-record name="action-event-record-primary-status-select" model="com.axelor.apps.crm.db.Event">
    	<field name="primaryStatusSelect" expr="eval: _callAllCrm"/>
    </action-record>
    
    <action-record name="action-ticket-record-new" model="com.axelor.apps.crm.db.Event">
    	<field name="quaternaryStatusSelect" expr="1"/>
    	<field name="ticketNumberSeq" expr="eval: com.axelor.apps.crm.db.Event.all().filter('self.typeSelect = 5').count() + 1"/>
    	<field name="prioritySelect" expr="eval: _prioritySelect"/>
    </action-record>
    
    <action-group name="action-event-new-record">
    	<action name="action-event-default-record"/>
    	<action name="action-ticket-record-new" if="typeSelect == 5"/> <!-- typeSelect == 5: ticket -->
    	<action name="action-event-default-record-userinfo"/>
    	<action name="action-event-record-primary-status-select" if="typeSelect == 1"/>
    	<action name="action-event-record-secondary-status-select" if="typeSelect == 2 || typeSelect == 1"/>
    	<action name="action-task-record-tertiary-status-select" if="typeSelect == 3"/>
    </action-group>
    
</object-views>