<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://apps.axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://apps.axelor.com/xml/ns/object-views http://apps.axelor.com/xml/ns/object-views/object-views_0.9.xsd">
    
    <grid name="bill-of-material-grid" title="Bills of material" model="com.axelor.apps.production.db.BillOfMaterial">
        <field name="product" domain="self.productTypeSelect = 'storable'"  onChange="action-bill-of-material-record-product"/>
        <field name="qty"/>
        <field name="unit"/>
        <field name="prodProcess"/>
    </grid>
    
    <form name="bill-of-material-form" title="Bill of material" model="com.axelor.apps.production.db.BillOfMaterial" cols="4"
    onNew="action-bill-of-material-default-record"
    onSave="action-bill-of-material-record-name">
    	<field name="name"/>
        <field name="product" domain="self.productTypeSelect = 'storable'"  onChange="action-bill-of-material-record-product"/>
        <field name="company" widget="SuggestBox" form-view="company-lite-form"/>
        <field name="qty"/>
        <field name="unit"/>
        <field name="prodProcess"/>
        <notebook colSpan="4">
        	<page title="Bill of material">
        		<field name="billOfMaterialList" colSpan="4" form-view="bill-of-material-line-form"  grid-view="bill-of-material-line-grid" domain="self.isRawMaterial = false"/>
        	</page>
        	<page title="Remains">
        		<field name="prodRemainsList" colSpan="4"/>
        	</page>
        	<page title="Cost">
        		<button name="computeCostPrice" title="Compute cost price" colSpan="2" onClick="save,action-bill-of-material-method-compute-cost-price"/>
        		<field name="costPrice" readonly="true"/>
        		<button name="updateProductCostPrice" title="update product cost price" colSpan="2" onClick="save,action-bill-of-material-method-update-product-cost-price"/>
        	</page>
        </notebook>
    </form>
    
    
    <grid name="bill-of-material-line-grid" title="Bills of material" model="com.axelor.apps.production.db.BillOfMaterial">
        <field name="priority" readonlyIf="isRawMaterial"/>
        <field name="product" domain="self.productTypeSelect = 'storable'"  onChange="action-bill-of-material-record-product"/>
        <field name="qty"/>
        <field name="unit"/>
        <field name="isRawMaterial"/>
        <field name="hasNoManageStock"/>
        <field name="prodProcess" readonlyIf="isRawMaterial"/>
    </grid>
    
    
     <form name="bill-of-material-line-form" title="Bill of material" model="com.axelor.apps.production.db.BillOfMaterial" cols="4"
    onNew="action-bill-of-material-line-default-record"
    onSave="action-bill-of-material-record-name">
    	<field name="priority" hideIf="isRawMaterial"/>
        <field name="product" domain="self.productTypeSelect = 'storable'" onChange="action-bill-of-material-record-product"/>
        <field name="qty"/>
        <field name="unit"/>
        <field name="isRawMaterial"/>
        <field name="hasNoManageStock"/>
        <field name="prodProcess" hideIf="isRawMaterial"/>
        <notebook colSpan="4" hideIf="isRawMaterial">
        	<page title="Bill of material">
        		<field name="billOfMaterialList" colSpan="4" form-view="bill-of-material-line-form"  grid-view="bill-of-material-line-grid" domain="self.isRawMaterial = false"/>
        	</page>
        	<page title="Remains">
        		<field name="prodRemainsList" colSpan="4"/>
        	</page>
        </notebook>
    </form>
    
    <action-record name="action-bill-of-material-default-record" model="com.axelor.apps.production.db.BillOfMaterial">
    	<field name="qty" expr="1"/>
    	<field name="company" expr="call:com.axelor.apps.base.service.user.UserInfoService:getUserActiveCompany()"/>
    </action-record>
    
     <action-record name="action-bill-of-material-line-default-record" model="com.axelor.apps.production.db.BillOfMaterial">
    	<field name="qty" expr="1"/>
    	<field name="priority" expr="10"/>
    </action-record>
    
    
    <action-record name="action-bill-of-material-record-product" model="com.axelor.apps.production.db.BillOfMaterial">
    	<field name="unit" expr="eval: product?.unit"/>
    </action-record>
    
     <action-record name="action-bill-of-material-record-name" model="com.axelor.apps.production.db.ProdProcess">
    	<field name="name" expr="eval: product.name + ' - ' + qty + unit.code + ' - ' + id"/>
    </action-record>
    
    <action-method name="action-bill-of-material-method-compute-cost-price">
    	<call class="com.axelor.apps.production.web.BillOfMaterialController" method="computeCostPrice"/>
    </action-method>
    
    <action-method name="action-bill-of-material-method-update-product-cost-price">
    	<call class="com.axelor.apps.production.web.BillOfMaterialController" method="updateProductCostPrice"/>
    </action-method>
    
    
</object-views>


