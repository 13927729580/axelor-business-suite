<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://apps.axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://apps.axelor.com/xml/ns/object-views http://apps.axelor.com/xml/ns/object-views/object-views_2.0.xsd">
	  
	<chart name="chart.human.resources.dashboard.portal.hr.employees.gender.distribution" title="Employees gender distribution">
 		 <dataset type="sql">
           SELECT
		          COUNT(_employee.id) AS _num_emp,
		          (case 
		            when _item.title in ('M.', 'Dr', 'Prof.') then 'Male' 
		            when _item.title in ('Ms.', 'Mss.') then 'Female' end
		          ) AS _gender	
		  FROM
         		 organisation_employee AS _employee
          JOIN
         		 meta_select AS _selection
       	  ON
         		_selection.name = 'partner.title.type.select'
          JOIN
            	 meta_select_item AS _item
          ON
          		_item.select_id = _selection.id
          		AND cast(_item.value as int) = _employee.title_select
          GROUP BY
         	 _gender
         	 
 		 </dataset>
		 <category key="_gender" type="text"/>
		 <series key="_num_emp" type="donut"/>
	</chart>
	  
	  
	<chart name="chart.hr.nbr.of.employees.by.gender" title="Employees by gender">
	  <dataset type="sql">
	
	    SELECT
	      COUNT(_employee.id) AS _num_emp,
	      (case 
	        when _employee.title_select in (1) then 'Men' 
	        when _employee.title_select in (2,3) then 'Women' end
	      ) AS _gender	
	    FROM
	      organisation_employee AS _employee
	    GROUP BY
	      _gender
	    
	  </dataset>
	  <category key="_gender" type="text"/>
	  <series key="_num_emp" type="bar"/>
	</chart>
	
	<chart name="chart.hr.employees.by.category.distribution" title="Employees by macro-category">
	  <dataset type="sql">
		    SELECT
			        COUNT(case when cast(_item.value as int) = _employee.macro_category_select then _employee.id end) AS _num_emp,
			        _item.title AS _macro_category	
		    FROM
			        organisation_employee AS _employee
		    JOIN
			        meta_select AS _selection
		    ON
			      _selection.name = 'organisation.candidate.macroCategory.select'
		    JOIN
			      meta_select_item AS _item
		    ON
			      _item.select_id = _selection.id
			  GROUP BY
			      _macro_Category
	  </dataset>
	 <category key="_macro_category" type="text"/>
	 <series key="_num_emp" type="donut"/>
	</chart>
	
	<chart name="chart.hr.nbr.of.employees.by.category" title="Employees by macro-category">
	  <dataset type="sql">
	
		SELECT
			COUNT(case when cast(_item.value as int) = _employee.macro_category_select then _employee.id end) AS _num_emp,
			_item.title AS _macro_category,
			_item.order_seq
		FROM
			organisation_employee AS _employee
		JOIN
			meta_select AS _selection
		ON
			_selection.name = 'organisation.candidate.macroCategory.select'
		JOIN
			meta_select_item AS _item
		ON
			_item.select_id = _selection.id
		GROUP BY
			_macro_category, _item.order_seq
		ORDER BY
			_item.order_seq    
			
	  </dataset>
	  <category key="_macro_category" type="text"/>
	  <series key="_num_emp" type="bar"/>
	</chart>	  
	
	
<chart name="chart.hr.employees.contract.type.distribution" title="Employees contract type distribution">
  <dataset type="sql">
       SELECT
          COUNT(case when cast(_item.value as int) = _employee.contract_type_select then _employee.id end) AS _num_emp,
          _item.title AS contract_type
        FROM
          organisation_employee AS _employee
        JOIN
          meta_select AS _selection
        ON
           _selection.name = 'organisation.working.contract.type.select'
        JOIN
          meta_select_item AS _item
        ON
          _item.select_id = _selection.id
        GROUP BY
          contract_type
  </dataset>
 <category key="contract_type" type="text"/>
 <series key="_num_emp" type="donut"/>
</chart>

	<chart onInit="action-product-set-today-date" name="chart.hr.employees.turnover.ytd.vs.lastYear" title="Employees turnover per year">
	  
	  <search-fields>
	    <field name="todayDate" title="End Date" type="date" />
	  </search-fields>
	  
	  <dataset type="sql">
	  
	    SELECT
	      COUNT(_employee.id) AS _count,
	      (case 
	
	      when
	        _employee.entry_date &lt;= DATE(:todayDate)
	        AND DATE_PART('year', _employee.entry_date) = DATE_PART('year', DATE(:todayDate))		
	      then 'Arrived'
	
	      when 	_employee.entry_date &lt;= DATE(:todayDate)
	        AND (_employee.exit_date IS NULL OR _employee.exit_date >= DATE(:todayDate))
	      then 'Present'
	
	      when 
	        _employee.exit_date &lt;= DATE(:todayDate)
	        AND DATE_PART('year', _employee.exit_date) = DATE_PART('year', DATE(:todayDate))
	      then 'Departed'
	
	      when
	        DATE_PART('year', _employee.entry_date) &gt; DATE_PART('year', DATE(:todayDate))		
	      then 'Future Join'
	    
	      end) AS _status      
	    FROM
	      organisation_employee AS _employee    
	    GROUP BY
	      _status
	  
	  </dataset>
	  <category key="_status" type="text" title="Status"/>
	  <series key="_count" type="bar" title="Employees"/>
	</chart>
	
	<chart onInit="action-product-set-today-date" name="chart.hr.nbr.of.employees.evolution" title="Number of Employees">
	  <search-fields>
	    <field name="todayDate" title="End Date" type="date" widget="[default='2014-12-31']"/>
	  </search-fields>
	  <dataset type="sql">
	    SELECT 
	       date_part('year',self.entry_date) As _year,
	       COUNT(self.id) AS _num_emp
	    FROM organisation_employee self
	    WHERE   
	       date_part('year',self.entry_date)&gt;date_part('year',DATE(:todayDate))-6  
	       AND date_part('year',self.entry_date) &lt; date_part('year',DATE(:todayDate)) 
	       AND (date_part('year',self.exit_date)&gt;date_part('year',self.entry_date) 
	       OR date_part('year',self.exit_date) IS NULL)
	    GROUP BY 
	       date_part('year',self.entry_date)
	   </dataset>
	  <category key="_year" type="text"/>
	  <series key="_num_emp" type="bar"/>
	</chart>
	
</object-views>