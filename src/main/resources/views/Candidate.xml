<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://apps.axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://apps.axelor.com/xml/ns/object-views http://apps.axelor.com/xml/ns/object-views/object-views_0.9.xsd">


	<grid name="candidate-grid" title="Candidates" model="com.axelor.apps.organisation.db.Candidate">
		<field name="name" />
		<field name="firstName" />
		<field name="mobilePhone" />
		<field name="email"/>
		<field name="avalabilitySelect" />
		<field name="availabilityDate" />
		<field name="salaryExpectation" />
	</grid>


	<form name="candidate-form" title="Candidate" model="com.axelor.apps.organisation.db.Candidate" 
	 	onSave="action-organisation-candidate-save-record"
		onNew="action-record-candidate-default,action-method-candidate-default-record,action-attrs-candidate-recruitment-advancement">
		<toolbar>
			<button name="transformInEmployee" title="Transform into employee" onClick="save,action-candidate-method-transform-in-employee" />
		</toolbar>
		<group name="header" cols="6" colSpan="6">
			<group colSpan="1">
				<field name="picture" showTitle="false" widget="image"/>
			</group>
			<group colSpan="3" cols="6" showTitle="false" css="highlight">
				<field name="titleSelect" showTitle="false" readonly="true"/>
				<field name="name" showTitle="false" readonly="true"/>
				<field name="firstName" showTitle="false" readonly="true"/>
				<break/>
				<field name="fonction" grid-view="keyword-profession-grid" form-view="keyword-profession-form" domain="self.typeSelect = '3'"/>
				<field name="titleSelect" hideIf="$readonly()"/>
			</group>
			<break/>
			<group colSpan="3" cols="6">
				<field name="titleSelect" hideIf="$readonly()"/>
				<field name="name" hideIf="$readonly()"/>
				<field name="firstName" hideIf="$readonly()"/>
			</group>
			<break/>
			<group title="Coordonnées" cols="6" colSpan="6">
				<field name="mobilePhone" />
				<field name="fixedPhone" />
				<field name="email" widget="Email"/>
				<field name="address" />
			</group>
			<group title="Recruitment Type" cols="6" colSpan="6">	
				<field name="recruitmentTypeSelect" />
				<field name="macroCategorySelect" />
				<field name="categorySelect" />
			</group>
		</group>
		<notebook>
			<page title="General" cols="6" colSpan="6">
				<field name="relocationSelect" />
				<field name="metierRecherche" grid-view="keyword-profession-grid" form-view="keyword-profession-form" domain="self.typeSelect = '3'"/>
				<field name="contratRecherche" />
				<field name="salaryExpectation" />
				<field name="globalEvaluation" />
				<field name="permis" />
				<field name="resume" />
				<field name="coverLetter" />
				<field name="source" />
				<group title="Candidate Follow up" cols="6" colSpan="6">	
					<field name="userInfo"/>
					<field name="createdOn" readonly="true"/>
					<break/>
					<field name="avalabilitySelect" />
					<field name="availabilityDate" />
					<field name="decisionDate" />
					<group title="Recruitment process advancement" cols="6" colSpan="6">
						<field name="etatCandidature" readonly="true"/>
						<field name="commentaire"/>
						<field name="recruitementDate" showIf="etatCandidature == 2 || etatCandidature == 3 || etatCandidature == 4"/>
						<group title="Action(s)" colSpan="6" cols="6" hideIf="etatCandidature == 8">
							<button name="nouvelleCandidature" title="Nouvelle candidature" colSpan="6" onClick="action-record-recruitment-advancement,save,action-method-candidate-create-recruitment-process-line,action-record-candidate-reset-fields,save" showIf="etatCandidature == 6 || etatCandidature == 9"/>
							<button name="preSelection" title="Pré-selectionné" colSpan="6" onClick="action-record-recruitment-advancement,save,action-method-candidate-create-recruitment-process-line,action-record-candidate-reset-fields,save" showIf="etatCandidature == 1"/>
							<button name="premierEntretien" title="Premier entretien" onClick="action-record-recruitment-advancement,save,action-method-candidate-create-recruitment-process-line,action-record-candidate-reset-fields,save" showIf="etatCandidature == 2"/>
							<button name="deuxiemeEntretien" title="Deuxième entretien" onClick="action-record-recruitment-advancement,save,action-method-candidate-create-recruitment-process-line,action-record-candidate-reset-fields,save" showIf="etatCandidature == 3"/>
							<button name="troisiemeEntretien" title="Troisième entretien" onClick="action-record-recruitment-advancement,save,action-method-candidate-create-recruitment-process-line,action-record-candidate-reset-fields,save" showIf="etatCandidature == 4"/>
							<button name="rejectRecruitmentAdvancement" title="Rejetée" showIf="etatCandidature == 2 || etatCandidature == 3 || etatCandidature == 4 || etatCandidature == 5" onClick="action-record-button-reject,save,action-method-candidate-create-recruitment-process-line,action-record-candidate-reset-fields,save"/>
							<button name="proposeOfferRecruitmentAdvancement" title="Offre proposée" showIf="etatCandidature == 3 || etatCandidature == 4 || etatCandidature == 5" onClick="action-record-candidate-propose-offer-recruitment-advancement,save,action-method-candidate-create-recruitment-process-line,action-record-candidate-reset-fields,save"/>
							<button name="acceptOfferRecruitmentAdvancement" title="Offre acceptée" showIf="etatCandidature == 7" onClick="action-record-candidate-propose-offer-recruitment-advancement,save,action-method-candidate-create-recruitment-process-line,action-record-candidate-reset-fields,save"/>
							<button name="rejectOfferRecruitmentAdvancement" title="Offre refusée" showIf="etatCandidature == 7" onClick="action-record-button-reject-offer,save,action-method-candidate-create-recruitment-process-line,action-record-candidate-reset-fields,save"/>
						</group>
						<field name="recruitmentProcessAdvancementList" readonly="true" grid-view="recruitment-candidate-process-advancement-grid" colSpan="6"/>
					</group>
				</group>
			</page>
			<page title="Profile">
				<group title="-" cols="4" colSpan="6">
					<group title="Keywords" colSpan="2">
						<field name="toolKeywordSet" domain="self.typeSelect = '1'" colSpan="2" grid-view="keyword-tool-grid" form-view="keyword-tool-form" widget="TagSelect[create=keyWord]"/>
						<field name="fieldKeywordSet" domain="self.typeSelect = '2'" colSpan="2" grid-view="keyword-area-grid" form-view="keyword-area-form" widget="TagSelect[create=keyWord]"/>
						<field name="jobKeywordSet" domain="self.typeSelect = '3'" colSpan="2" grid-view="keyword-profession-grid" form-view="keyword-profession-form" widget="TagSelect[create=keyWord]"/>
					</group>
					<group title="Companies" colSpan="2">
						<field name="partnerSet" colSpan="4" grid-view="company-grid" domain="self.isContact = 'true'"/>
					</group>
				</group>
				<field name="positionList" colSpan="4"/>	
				<group title="Education/Trainings" cols="4" colSpan="4">	
					<field name="degree"/>
					<!-- TODO set domain domain="self.id IN (1, 2, 3)" -->
<!--					<button name="assign" title="Affect to recruitment pool" -->
<!-- 						help="Copy all necessary fields (including Professionnal Background …)" -->
<!-- 						colSpan="2" /> -->
					<field name="niveauEtudes" />
					<field name="trainingLineList" colSpan="4"/>
				</group>
			</page>
			<page title="Evaluation">
				<field name="evaluationLineList" colSpan="4"
					form-view="evaluation-line-form" grid-view="evaluation-line-grid"/>
				<field name="evaluationGrade" readonly="true"/>
				<button name="compute" title="Compute" onClick="action-organisation-candidate-evaluation-record"/>
			</page>
			<page title="Additionnal information">
				<field name="personalInfo" widget="NestedEditor" summary-view="true"
					form-view="personal-info-edit-form" hidden="true"/>
			</page>
			<page title="Competences">
				<field name="competence" widget="NestedEditor" summary-view="true"
					form-view="competence-edit-form" hidden="true"/>
			</page>
			<page title="Other opportunities">
				<field name="candidateOtherOpportunityList" grid-view="candidate-other-opportunity-grid" form-view="candidate-other-opportunity-form"/>
			</page>
			<page title="Reporting">
				<group title="Action(s)" colSpan="2" cols="2">
                    <group colSpan="1" cols="1">
                        <button name="showCandidate" title="Print CV" colSpan="1" icon="img/icons/print.png" onClick="save,action-partner-method-show-candidate"/>
                    </group>
                </group>
			</page>
<!-- 			<page title="Suivi du placement des besoins" hidden="true"> -->
<!-- 				<field name="placementFollowUpList" grid-view="placement-follow-up-edit-grid" form-view="placement-follow-up-edit-list"></field> -->
<!-- 			</page> -->
		</notebook>
	</form>

	<action-record name="action-organisation-candidate-evaluation-record" model="com.axelor.apps.organisation.db.Candidate">
		<field name="evaluationGrade" expr="eval: evaluationLineList?.collect(){ it?.coefficient * it?.gradeSelect }?.sum() / evaluationLineList?.collect(){ it?.coefficient }?.sum()" />
	</action-record>

	<action-record name="action-organisation-candidate-save-record" model="com.axelor.apps.organisation.db.Candidate">
		<field name="toolKeywordSet" expr="eval: toolKeywordSet*.typeSelect = '0';toolKeywordSet" />
		<field name="fieldKeywordSet" expr="eval: fieldKeywordSet*.typeSelect = '1';fieldKeywordSet" />
		<field name="jobKeywordSet"	expr="eval: jobKeywordSet*.typeSelect = '2';jobKeywordSet" />
	</action-record>

	<action-method name="action-method-candidate-default-record">
		<call class="com.axelor.apps.organisation.web.CandidateController" method="onNew" />
	</action-method>
	
	<action-method name="action-partner-method-show-candidate">
		<call class="com.axelor.apps.organisation.web.CandidateController" method="showCandidate" />
	</action-method>
	
	<action-method name="action-candidate-method-transform-in-employee">
		<call class="com.axelor.apps.organisation.web.CandidateController" method="transformInEmployee"/>
	</action-method>

	<action-record name="action-record-recruitment-advancement" model="com.axelor.apps.organisation.db.Candidate">
		<field name="etatCandidature" expr="5" if="etatCandidature == 4"/>
		<field name="etatCandidature" expr="4" if="etatCandidature == 3"/>
		<field name="etatCandidature" expr="3" if="etatCandidature == 2"/>
		<field name="etatCandidature" expr="2" if="etatCandidature == 1"/>
		<field name="etatCandidature" expr="1" if="etatCandidature == 6"/>
		<field name="etatCandidature" expr="1" if="etatCandidature == 9"/>			
	</action-record>
	
	<action-record name="action-record-candidate-propose-offer-recruitment-advancement" model="com.axelor.apps.organisation.db.Candidate">
		<field name="etatCandidature" expr="8" if="etatCandidature == 7"/>
		<field name="etatCandidature" expr="7" if="etatCandidature == 5"/>
		<field name="etatCandidature" expr="7" if="etatCandidature == 4"/>
		<field name="etatCandidature" expr="7" if="etatCandidature == 3"/>
	</action-record>
	
	<action-record name="action-record-candidate-default" model="com.axelor.apps.organisation.db.Candidate">
		<field name="etatCandidature" expr="1" />
	</action-record>
	
	<action-record name="action-record-button-reject" model="com.axelor.apps.organisation.db.Candidate">
		<field name="etatCandidature" expr="6" />
	</action-record>
	
	<action-record name="action-record-button-reject-offer" model="com.axelor.apps.organisation.db.Candidate">
		<field name="etatCandidature" expr="9" />
	</action-record>

	<action-record name="action-record-candidate-reset-fields" model="com.axelor.apps.organisation.db.Candidate">
		<field name="recruitementDate" expr=""/>
		<field name="commentaire" expr=""/>
	</action-record>
	
	<action-method name="action-method-candidate-create-recruitment-process-line">
		<call class="com.axelor.apps.organisation.web.CandidateController" method="createRecruitmentProcessAdvancementLine" />
	</action-method>

</object-views>