<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://apps.axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://apps.axelor.com/xml/ns/object-views http://apps.axelor.com/xml/ns/object-views/object-views_0.9.xsd">
    
    
    <calendar name="leave-request-calendar" title="Leave requests" mode="month" colorBy="employeeUserInfo" 
	    eventStart="startDateT" 
	    eventStop="endDateT" 
	    eventLength="1">
	    <field name="leaveRequestReason" />
 	 </calendar>
    
    <grid name="leave-request-grid" title="Leave requests" model="com.axelor.apps.organisation.db.LeaveRequest">
        <field name="employeeUserInfo"/>
        <field name="requestDate"/>
        <field name="startDateT"/>
        <field name="endDateT"/>
        <field name="nbrOfDayOff"/>
        <field name="leaveRequestReason"/>
        <field name="managerUserInfo"/>
        <field name="approvalDate"/>
        <field name="remainingDaysOnPeriod"/>
        <field name="statusSelect"/>
    </grid>
    
    <form name="leave-request-form" title="Leave request" model="com.axelor.apps.organisation.db.LeaveRequest" cols="4"
    	onNew="action-leave-request-record-new">
		<field name="employeeUserInfo"/>
        <field name="requestDate"/>
        <field name="leaveRequestReason"/>
        <separator colSpan="4"/>
        <group title="Leave period" colSpan="3" cols="6">
        	<field name="startDateT" onChange="action-leave-request-method-compute-start-date-time"/>
        	<field name="endDateT" onChange="action-leave-request-method-compute-end-date-time"/>
        	<field name="nbrOfDayOff" onChange="action-leave-request-method-compute-duration"/>
        </group>
        <field name="remainingDaysOnPeriod"/>
        <separator colSpan="4"/>
        <group colSpan="4" cols="6">
	        <field name="managerUserInfo"/>
	        <field name="approvalDate"/>
	        <field name="statusSelect" widget="NavSelect"/>
        </group>
        <button name="confirm" title="Confirm" colSpan="2" showIf="statusSelect == 1 || statusSelect == 4" onClick="action-leave-request-button-confirmation,save,action-leave-request-record-confirm,save"/>
        <button name="cancel" title="Cancel" colSpan="2" showIf="statusSelect == 2 ||Â statusSelect == 3" onClick="action-leave-request-button-cancel,save,action-leave-request-record-cancel,save"/>
        <button name="validate" title="Validate" colSpan="2" showIf="statusSelect == 2" onClick="action-leave-request-button-validation,save,action-leave-request-method-validate,action-leave-request-record-validate,save"/>
    </form>
    
    
    <action-record name="action-leave-request-record-new" model="com.axelor.apps.organisation.db.LeaveRequest">
    	<field name="employeeUserInfo" expr="call:com.axelor.apps.base.service.user.UserInfoService:getUserInfo()"/>
    	<field name="requestDate" expr="call:com.axelor.apps.base.service.administration.GeneralService:getTodayDate()"/>
    	<field name="statusSelect" expr="eval: 1"/>
    </action-record>
    
     <action-record name="action-leave-request-record-confirm" model="com.axelor.apps.organisation.db.LeaveRequest">
    	<field name="statusSelect" expr="2"/>
    </action-record>
    
     <action-record name="action-leave-request-record-cancel" model="com.axelor.apps.organisation.db.LeaveRequest">
    	<field name="statusSelect" expr="4"/>
    </action-record>
    
    <action-record name="action-leave-request-record-validate" model="com.axelor.apps.organisation.db.LeaveRequest">
    	<field name="approvalDate" expr="call:com.axelor.apps.base.service.administration.GeneralService:getTodayDate()"/>
    	<field name="statusSelect" expr="3"/>
    </action-record>
    
    <action-method name="action-leave-request-method-validate">
    	<call class="com.axelor.apps.organisation.web.LeaveRequestController" method="validate"/>
    </action-method>
    
    <action-validate name="action-leave-request-button-cancel">
    	<error message="The holiday period already started you can not cancel this holiday." if="statusSelect == 3 &amp;&amp; startDateT &lt; __time__"/>    	
	</action-validate> 

	<action-validate name="action-leave-request-button-validation">
    	<error message="The holiday request date should be equal or before the today date." if="requestDate &gt; __date__"/>
    	<error message="Holiday requests duration must always be greater than 0." if="nbrOfDayOff == 0"/>
    	<error message="The holiday end date must be after the start date." if="endDateT &lt; startDateT"/>
		<error message="The holiday request duration is greater than the remaining holidays. Please contact your supervisor to be credited with advance holidays permission." if="nbrOfDayOff &gt; remainingDaysOnPeriod"/>	
		<error message="You are not allowed to validate this holiday request, please refer to your supervisor (the supervisor is listed in the employee hierarchy notebook)." if="__user__.id != managerUserInfo?.internalUser.id"/>
	</action-validate> 
	
	<action-validate name="action-leave-request-button-confirmation">
    	<error message="Start date required." if="startDateT == null"/>
    	<error message="Leave request reason required." if="leaveRequestReason == null"/>
    	<error message="Request date required." if="requestDate == null"/>
	</action-validate> 
	
	<action-method name="action-leave-request-method-compute-start-date-time">
    	<call class="com.axelor.apps.organisation.web.LeaveRequestController" method="computeStartDateTime"/>
    </action-method>
    
    <action-method name="action-leave-request-method-compute-end-date-time">
    	<call class="com.axelor.apps.organisation.web.LeaveRequestController" method="computeEndDateTime"/>
    </action-method>
    
    <action-method name="action-leave-request-method-compute-duration">
    	<call class="com.axelor.apps.organisation.web.LeaveRequestController" method="computeDuration"/>
    </action-method>
    
</object-views>