<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://apps.axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://apps.axelor.com/xml/ns/object-views http://apps.axelor.com/xml/ns/object-views/object-views_0.9.xsd">

	<grid name="expense-edit-line-grid" editable="true" title="Expense Lines"
		model="com.axelor.apps.organisation.db.ExpenseLine">
		<field name="product" />
		<field name="shortDescription" />
		<field name="expenseTypeSelect" />
		<field name="project" />
		<field name="qty" />
		<field name="unit" />
		<field name="price" />
		<field name="total" />
		<field name="file" />
		<field name="fileReceived" />
		<field name="validationDate" />
	</grid>


	<grid name="expense-line-grid" title="Expense Line"
		model="com.axelor.apps.organisation.db.ExpenseLine">
		<field name="product" />
		<field name="shortDescription" />
		<field name="expenseTypeSelect" />
		<field name="project" />
		<field name="qty" />
		<field name="unit" />
		<field name="price" />
		<field name="total" />
		<field name="file" />
		<field name="fileReceived" />
		<field name="validationDate" />
	</grid>

	<form name="expense-line-form" title="Expense Line"
		model="com.axelor.apps.organisation.db.ExpenseLine" cols="4" onNew="action-expenseline-default-record">

	    <group title="Context" colSpan="4">
	        <field name="sequence"/>
	        <field name="reference"/>
	        <field name="expenseTypeSelect"/>
	        <field name="affair"/>
	    </group>
	    <group title="Details" colSpan="4">
	        <field name="product" colSpan="2" onChange="action-expenseline-product,action-expenseline-compute-total" domain="self.applicationTypeSelect = 3 and self.endDate IS NULL or CURRENT_DATE &lt; self.endDate"/>
	        <field name="shortDescription" colSpan="4"/>
	        <field name="qty" onChange="action-expenseline-compute-total"/>
	        <field name="unit"/>
	        <field name="price" onChange="action-expenseline-compute-total"/>
	        <field name="total"/>
	    </group>
	    <break/>
	    <group title="Proofs" colSpan="4">
	        <field name="file"/>
	        <field name="fileReceived"/>
	    </group>
	    <group title="Validation/Invoicing" colSpan="6">
	        <field name="validationDate"/>
	        <field name="istoInvoice"/>
	        <field name="isInvoiced"/>
	    </group>
	</form>

	<action-record name="action-expenseline-default-record" model="com.axelor.apps.organisation.db.ExpenseLine">
    	<field name="expenseTypeSelect" expr="eval: 2"/>
    	<field name="fileReceived" expr="eval: 2"/>
    	<field name="qty" expr="1"/>
    </action-record>
    
    <action-record name="action-expenseline-compute-total" model="com.axelor.apps.organisation.db.ExpenseLine">
    	<field name="total" expr="eval:qty*price" if="qty != null &amp;&amp; price != null"/>
    </action-record>
    
    <action-record name="action-expenseline-product" model="com.axelor.apps.organisation.db.ExpenseLine">
    	<field name="shortDescription" expr="product?.name" if="product"/>
    	<field name="unit" expr="eval: product?.unit" if="product"/>
    	<field name="price" expr="eval: product?.purchasePrice" if="product"/>
    </action-record>
    
    <action-record name="action-expenseline-record-validation-date" model="com.axelor.apps.organisation.db.ExpenseLine">
    	<field name="validationDate" expr="call:com.axelor.apps.base.service.administration.GeneralService:getTodayDate()" if="fileReceived == '1'"/>
    	<field name="validationDate" expr="" if="fileReceived == '2'"/>
    </action-record>
    
</object-views>