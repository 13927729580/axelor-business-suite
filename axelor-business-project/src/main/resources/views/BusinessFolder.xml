<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_3.0.xsd">

	<grid name="business-folder-grid" title="Business Folders" model="com.axelor.apps.businessproject.db.BusinessFolder">
		<field name="code"/>
		<field name="name"/>
		<field name="customer"/>
		<field name="userResponsible" />
		<field name="createdOn" />
		<field name="statusSelect" />
	</grid>

	<form name="business-folder-form" title="Business Folder" model="com.axelor.apps.businessproject.db.BusinessFolder" onSave="action-business-folder-set-seq">
		<panel title="Overview">
		    <field name="name"/>
			<field name="code" readonly="true"/>
			<field name="customer" domain="self.isCustomer = true"/>
			<field name="userResponsible" />
			<field name="statusSelect" readonly="true" colSpan="3"/>
			<button name="close" title="Close" colSpan="3" onClick="action-business-project-set-status-close,save" showIf="statusSelect == 1" readonlyIf="id == null"/>
			<button name="open" title="Open" colSpan="3" onClick="action-business-project-set-status-open,save" showIf="statusSelect == 2" readonlyIf="id == null"/>
			<button name="createSalesOrder" title="Create Sales Order" colSpan="3"  readonlyIf="id == null" onClick="save,action-business-folder-method-create-sale-order"/>
			<field name="$template" title="Template" type="many-to-one" target="com.axelor.apps.sale.db.SaleOrder" domain="self.template = true" canNew="false" colSpan="6" form-view="sale-order-template-form"/>
			<button name="createSalesOrderFromTemplate" title="Create Sale Order From Template" colSpan="6" readonlyIf="id == null" onClick="save,action-business-folder-method-create-sale-order-from-template"/>
		</panel>
		<panel-tabs>
			<panel title="Financial Information">
				<panel title="Sales">
					<field name="totalSaleOrdersFinalized"/>
					<field name="totalSaleOrdersConfirmed"/>
					<field name="totalSaleOrdersInvoiced"/>
				</panel>
				<panel title="Purchases">
					<field name="totalPurchaseOrdersFinalized"/>
					<field name="totalPurchaseOrdersConfirmed"/>
					<field name="totalPurchaseOrdersInvoiced"/>
				</panel>
				<panel title="Internal">
					<panel title="Log Times">
						<field name="totalTimesPlanned"/>
						<field name="totalTimesRealised"/>
					</panel>
					<panel title="Expenses">
						<field name="totalExpenses"/>
					</panel>
					<panel title="Production">
						<field name="totalEstimatedCosts"/>
						<field name="totalRealCosts"/>
					</panel>
					<button name="dashBoardButton" title="See DashBoard"/>
					<button name="computeDetailsButton" title="See Compute Details"/>
				</panel>
				<panel title="Margins">
					<field name="totalProducedTO"/>
					<field name="estimatedMargin"/>
					<field name="realTimesMargin"/>
					<field name="realInvoicingMargin"/>
					<button name="monthlyDetails" title="See Monthly Details"/>
				</panel>
			</panel>
			<panel title="Project Tree">
				<panel-dashlet action="action-business-folder-view-show-project-tree" colSpan="12" title="Project Tree"/>
			</panel>
		</panel-tabs>
		<panel>
			<field name="createdBy" title="User Opened"/>
			<field name="userClosed" readonly="true"/>
			<field name="createdOn" title="Date Opened"/>
			<field name="dateClosed" readonly="true"/>
		</panel>
	</form>
	
	<action-record name="action-business-folder-set-seq" model="com.axelor.apps.businessproject.db.BusinessFolder">
	    <field name="code" expr="call:com.axelor.apps.base.service.administration.SequenceService:getSequenceNumber('businessFolder')" if="code == null"/>
	</action-record>
	
	<action-record name="action-business-project-set-status-close" model="com.axelor.apps.businessproject.db.BusinessFolder">
	    <field name="statusSelect" expr="eval:2" />
	    <field name="dateClosed" expr="eval:__date__" />
	    <field name="userClosed" expr="eval:__user__" />
	</action-record>
	
	<action-record name="action-business-project-set-status-open" model="com.axelor.apps.businessproject.db.BusinessFolder">
	    <field name="statusSelect" expr="eval:1" />
	</action-record>
	
	<action-view name="action-business-folder-view-show-project-tree" title="Project Tree" model="com.axelor.apps.project.db.ProjectTask">	
		<view type="tree" name="project-tree"/>
    	<view type="form" name="project-form"/>
    	<domain>self.folder.id = :id</domain>
     	<context name="id" expr="eval: id"/>
	</action-view>
	
	<action-method name="action-business-folder-method-create-sale-order">
		<call class="com.axelor.apps.business.project.web.BusinessFolderController" method="generateViewSaleOrder"/>
	</action-method>
	
	<action-method name="action-business-folder-method-create-sale-order-from-template">
		<call class="com.axelor.apps.business.project.web.BusinessFolderController" method="generateViewSaleOrderFromTemplate"/>
	</action-method>
	    
</object-views>
