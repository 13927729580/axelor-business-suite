<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_4.0.xsd">
	
	<grid name="ebics-user-grid" title="Ebics user" model="com.axelor.apps.account.db.EbicsUser" >
		<field name="name" />
		<field name="userId" />
		<field name="ebicsTypeSelect"/>
		<field name="statusSelect"/>
		<field name="ebicsPartner"/>
		<field name="ebicsPartner.ebicsBank"/>
	</grid>
	
	<form name="ebics-user-form" title="Ebics user" model="com.axelor.apps.account.db.EbicsUser" onSave="save,action-ebics-user-method-generate-dn">
		<panel title="General informations" colSpan="12">
			<field name="name" />
			<field name="password" />
			<field name="userId" help="Name of the user or service" x-bind="{{userId|uppercase}}" pattern='^[A-Z0-9]+$'/>
			<field name="ebicsTypeSelect" widget="RadioSelect"/>
			<field name="securityMedium" />
			<field name="associatedUser"/>
			<field name="ebicsPartner" help="Subscription or contract to which the user is associated" />
			<field name="ebicsPartner.ebicsBank"/>
			<field name="statusSelect" colSpan="12"/>
		</panel>
		<panel-tabs>
			<panel title="Certificates">
				<panel title="DN" colSpan="6" itemSpan="12" showIf="ebicsTypeSelect == 0" hidden="true">
					<button name="generateDn" title="Generate DN" onClick="save,action-ebics-user-method-generate-dn" showIf="!dn"/>
					<field name="dn" readonly="true" help="Defines a unique identifier for the certificate" />
				</panel>
				<panel title="Electronic signature certificate" colSpan="6" itemSpan="12" readonlyIf="ebicsTypeSelect == 0" showIf="ebicsTypeSelect == 1 || (ebicsTypeSelect == 0  &amp;&amp; statusSelect >= 1)">
					<field name="a005Certificate" readonlyIf="ebicsTypeSelect == 0"/>
					<field name="a005PrivateKey" readonlyIf="ebicsTypeSelect == 0"/>
				</panel>
				<panel title="Encryption certificate" colSpan="6" itemSpan="12" readonlyIf="ebicsTypeSelect == 0" showIf="ebicsTypeSelect == 1 || (ebicsTypeSelect == 0  &amp;&amp; statusSelect >= 1)">
					<field name="e002Certificate"/>
					<field name="e002PrivateKey"/>
				</panel>
				<panel title="Authentication certificate" colSpan="6" itemSpan="12" readonlyIf="ebicsTypeSelect == 0" showIf="ebicsTypeSelect == 1 || (ebicsTypeSelect == 0  &amp;&amp; statusSelect >= 1)">
					<field name="x002Certificate"/> 
					<field name="x002PrivateKey"/>
				</panel>
			</panel>
			<panel-related field="ebicsRequestLogList" form-view="ebics-request-log-form" grid-view="ebics-request-log-grid" readonly="true"/>
		</panel-tabs>
		
		<panel sidebar="true">
			<button name="generateCertificates" title="Generate certificates" onClick="save,action-ebics-user-method-generate-certificates" hidden="true" showIf="ebicsTypeSelect == 0 &amp;&amp; dn &amp;&amp; (statusSelect == 0 || statusSelect == 4)"/>
			<button name="sendINI" title="Send certificate of signature A005 (INI)" onClick="save,action-ebics-user-method-send-ini" help="true" hidden="true" showIf="statusSelect == 1"/>
			<button name="sendHIA" title="Send authentication X002 and Encryption E002 certificates (HIA)" onClick="save,action-ebics-user-method-send-hia" help="true" hidden="true" showIf="statusSelect == 2"/>
			<button name="sendHPB" title="Get the server certificates (HPB)" onClick="save,action-ebics-user-method-send-hpb" showIf="statusSelect >= 3"/>
			<button name="sendSPR" title="Send Suspension of access authorisation (SPR)" onClick="save,action-ebics-user-method-send-spr" showIf="statusSelect == 3"/>
			<button name="sendFUL" title="Send file upload request (FUL)" onClick="save,action-ebics-user-method-send-ful" showIf="statusSelect == 3"/>
			<button name="sendFDL" title="Send file download request (FDL)" onClick="save,action-ebics-user-method-send-fdl" showIf="statusSelect == 3"/>
			<button name="sendHTD" title="Get the UserID state (HTD)" onClick="save,action-ebics-user-method-send-htd" showIf="statusSelect == 3"/>
			<button name="sendPTK" title="Get the user log (PTK)" onClick="save,action-ebics-user-method-send-ptk" showIf="statusSelect == 3"/>
		</panel>
	
	</form>
	
	<action-method name="action-ebics-user-method-generate-certificates">
		<call class="com.axelor.apps.account.ebics.web.EbicsController" method="generateCertificate"/>
	</action-method>
	
	<action-method name="action-ebics-user-method-generate-dn">
		<call class="com.axelor.apps.account.ebics.web.EbicsController" method="generateDn"/>
	</action-method>
	
	<action-method name="action-ebics-user-method-send-ini">
		<call class="com.axelor.apps.account.ebics.web.EbicsController" method="sendINIRequest"/>
	</action-method>
	
	<action-method name="action-ebics-user-method-send-hia">
		<call class="com.axelor.apps.account.ebics.web.EbicsController" method="sendHIARequest"/>
	</action-method>
	
	<action-method name="action-ebics-user-method-send-spr">
		<call class="com.axelor.apps.account.ebics.web.EbicsController" method="sendSPRRequest"/>
	</action-method>
	
	<action-method name="action-ebics-user-method-send-ful">
		<call class="com.axelor.apps.account.ebics.web.EbicsController" method="sendFULRequest"/>
	</action-method>
	
	<action-method name="action-ebics-user-method-send-fdl">
		<call class="com.axelor.apps.account.ebics.web.EbicsController" method="sendFDLRequest"/>
	</action-method>
    
    <action-method name="action-ebics-user-method-send-hpb">
  		<call class="com.axelor.apps.account.ebics.web.EbicsController" method="sendHPBRequest" />
    </action-method>
    
    <action-method name="action-ebics-user-method-send-htd">
  		<call class="com.axelor.apps.account.ebics.web.EbicsController" method="sendHTDRequest" />
    </action-method>
    
    <action-method name="action-ebics-user-method-send-ptk">
  		<call class="com.axelor.apps.account.ebics.web.EbicsController" method="sendPTKRequest" />
    </action-method>
  
</object-views>
